# Progress Log

## Learnings
(Patterns discovered during implementation)
- i18n: i18next + react-i18next for translations, AsyncStorage for language persistence
- Translation files live in src/i18n/locales/{en,es,fr}.ts; config in src/i18n/index.ts
- LanguageProvider wraps entire app in root layout; useLanguage() hook for context
- First-launch detection: check AsyncStorage for stored language; null = first launch
- Pattern: useTranslation() + t('key.path') in every screen for translated strings
- Language change: update i18n + AsyncStorage + UserProfile.referenceLanguage in DB
- Expo SDK 54 uses expo-router v6 with file-based routing
- Entry point for expo-router is "expo-router/entry" in package.json main field
- @expo/vector-icons must be installed separately with --legacy-peer-deps due to react-dom peer dep conflict
- Tab navigation in expo-router uses directory-based tabs: app/(tabs)/tabname/_layout.tsx + index.tsx
- npx expo install handles version compatibility; npm install --legacy-peer-deps for manual installs
- Old App.tsx and index.ts files should be removed when migrating to expo-router
- Test compilation with `npx expo export --platform android` instead of web (web needs react-dom)
- Theme/design system lives in src/theme/, shared components in src/components/
- Import theme: `import { colors, typography, spacing, borderRadius } from '../src/theme'`
- Import components: `import { Button, Card, ProgressBar, Badge } from '../src/components'`
- Link component with asChild for navigation buttons: `<Link href="..." asChild><Button .../></Link>`
- Database layer lives in src/database/; import via `import { ... } from '../src/database'`
- expo-sqlite v16 uses synchronous API: openDatabaseSync, runSync, getFirstSync, getAllSync, execSync
- DB schema uses snake_case columns; TypeScript models use camelCase; row-to-model mappers convert between them
- Singleton DB pattern: getDatabase() lazily initializes and returns cached instance
- CRUD pattern: typed Row interface → rowToModel mapper → parameterized queries with ? placeholders
- Content schema: Course > Unit > Lesson > Exercise hierarchy in src/content/
- Seed data versioned via AsyncStorage; bump CURRENT_SEED_VERSION to re-seed
- Exercise types: multiple_choice, translation, fill_blank, match_pairs, listening
- LocalizedString { en, es, fr } used for all user-facing content text
- getCourseContent() for full course; getLessonById() for specific lessons
- Vocabulary inserted into DB on first load; exercises read from bundled TS

---

## Iteration 1 - US-001: Project Scaffolding & Navigation Shell
- What was implemented:
  - Expo project with TypeScript, expo-router v6 file-based routing
  - Bottom tab navigation with 4 tabs: Home, Lessons, Review, Profile
  - Stack navigator (_layout.tsx) nested in each tab directory
  - Placeholder screen for each tab with title and subtitle
- Files changed:
  - package.json (project setup, dependencies)
  - app.json (app name, scheme, expo-router plugin)
  - tsconfig.json (expo base config, strict mode)
  - app/_layout.tsx (root Stack layout)
  - app/(tabs)/_layout.tsx (tab navigator with Ionicons)
  - app/(tabs)/home/_layout.tsx + index.tsx
  - app/(tabs)/lessons/_layout.tsx + index.tsx
  - app/(tabs)/review/_layout.tsx + index.tsx
  - app/(tabs)/profile/_layout.tsx + index.tsx
- Learnings for future iterations:
  - create-expo-app won't run in a dir with existing files; use temp dir + copy approach
  - node_modules copy/move is unreliable; better to just `npm install` fresh
  - TypeScript check: `npx tsc --noEmit`; compilation test: `npx expo export --platform android`
  - Ionicons import: `import { Ionicons } from '@expo/vector-icons'`
---

## Iteration 2 - US-002: Theme, Design System & Shared Components
- What was implemented:
  - Color palette (primary blue, secondary gold, success/error/warning, backgrounds, text, borders)
  - Typography scale (heading1-3, body, bodyBold, caption, captionBold, button)
  - Spacing and border radius constants
  - Button component (primary/secondary/outline/ghost variants, sm/md/lg sizes, disabled/loading states)
  - Card component (elevated/outlined/filled variants)
  - ProgressBar component (configurable progress 0-1, color, height)
  - Badge component (primary/success/error/warning/neutral variants, sm/md sizes)
  - Light theme applied globally to all layouts and screens
  - Component showcase screen accessible from Profile tab
- Files changed:
  - src/theme/colors.ts (color palette)
  - src/theme/typography.ts (text styles)
  - src/theme/spacing.ts (spacing + border radius)
  - src/theme/index.ts (barrel export)
  - src/components/Button.tsx
  - src/components/Card.tsx
  - src/components/ProgressBar.tsx
  - src/components/Badge.tsx
  - src/components/index.ts (barrel export)
  - app/_layout.tsx (StatusBar + theme colors)
  - app/(tabs)/_layout.tsx (themed tab bar)
  - app/(tabs)/home/_layout.tsx + index.tsx (themed)
  - app/(tabs)/lessons/_layout.tsx + index.tsx (themed)
  - app/(tabs)/review/_layout.tsx + index.tsx (themed)
  - app/(tabs)/profile/_layout.tsx + index.tsx (themed + showcase link)
  - app/(tabs)/profile/component-showcase.tsx (new showcase screen)
- Learnings for future iterations:
  - src/theme/ and src/components/ are the canonical locations for design system code
  - All screens should import colors/typography/spacing from theme instead of hardcoded values
  - Stack screenOptions pattern for consistent headers: headerStyle, headerTitleStyle, headerShadowVisible, headerTintColor
  - Must read a file before writing to it (Claude tool requirement)
---

## Iteration 3 - US-003: Local Database & Data Models
- What was implemented:
  - expo-sqlite v16.0.10 installed via `npx expo install expo-sqlite`
  - Database initialization with WAL mode and schema auto-creation (src/database/db.ts)
  - TypeScript data models for all 5 entities: UserProfile, LessonProgress, VocabularyItem, ReviewCard, DailyStreak (src/database/types.ts)
  - Insert and Update helper types (Omit-based) for each model
  - Full CRUD helpers for each model with parameterized queries
  - Row-to-model mappers converting snake_case DB columns to camelCase TypeScript
  - Barrel export (src/database/index.ts) for clean imports
  - SQLite indexes on frequently queried columns (lesson_id, category, next_review_date, vocabulary_id)
  - Foreign key constraint: review_card.vocabulary_id → vocabulary_item.id with ON DELETE CASCADE
- Files changed:
  - package.json (added expo-sqlite dependency)
  - src/database/types.ts (data model types + insert/update types)
  - src/database/db.ts (database init, schema creation, getDatabase singleton)
  - src/database/userProfile.ts (CRUD for UserProfile)
  - src/database/lessonProgress.ts (CRUD for LessonProgress)
  - src/database/vocabularyItem.ts (CRUD for VocabularyItem)
  - src/database/reviewCard.ts (CRUD for ReviewCard)
  - src/database/dailyStreak.ts (CRUD for DailyStreak)
  - src/database/index.ts (barrel export)
- Learnings for future iterations:
  - expo-sqlite v16 sync API: openDatabaseSync, runSync, getFirstSync, getAllSync, execSync, withTransactionSync
  - SQLite stores booleans as INTEGER (0/1); mappers convert to/from TypeScript boolean
  - Update helpers use dynamic field building pattern to only SET provided fields
  - UserProfile and DailyStreak are singletons (one row); use getUserProfile()/getDailyStreak() without ID
  - Parameterized queries prevent SQL injection; execSync does NOT support params (only for DDL/PRAGMA)
---

## Iteration 4 - US-004: Reference Language Selection (EN / ES / FR)
- What was implemented:
  - i18next + react-i18next for internationalization with 3 reference languages (EN, ES, FR)
  - @react-native-async-storage/async-storage for persisting language selection
  - Translation files for all UI strings in English, Spanish, French
  - LanguageProvider context wrapping the entire app (manages init, first-launch, language changes)
  - Language picker screen shown on first launch (fullscreen with flag icons)
  - All UI strings across all screens now load from translation files via useTranslation()
  - Change Language screen accessible from Profile tab
  - Language selection persisted to both AsyncStorage and UserProfile.referenceLanguage in SQLite
  - Root layout handles loading state and first-launch redirect
- Files changed:
  - package.json (added i18next, react-i18next, @react-native-async-storage/async-storage)
  - src/i18n/locales/en.ts (English translations)
  - src/i18n/locales/es.ts (Spanish translations)
  - src/i18n/locales/fr.ts (French translations)
  - src/i18n/index.ts (i18n config, init, changeLanguage, AsyncStorage persistence)
  - src/i18n/LanguageProvider.tsx (React context for language state, first-launch detection)
  - app/_layout.tsx (LanguageProvider wrapper, loading state, first-launch redirect)
  - app/language-picker.tsx (first-launch language selection screen)
  - app/(tabs)/_layout.tsx (translated tab labels)
  - app/(tabs)/home/_layout.tsx + index.tsx (translated strings)
  - app/(tabs)/lessons/_layout.tsx + index.tsx (translated strings)
  - app/(tabs)/review/_layout.tsx + index.tsx (translated strings)
  - app/(tabs)/profile/_layout.tsx + index.tsx (translated strings, change language button)
  - app/(tabs)/profile/change-language.tsx (language change screen in Profile stack)
- Learnings for future iterations:
  - i18next init is async; LanguageProvider shows loading spinner until ready
  - useTranslation() returns { t, i18n }; t('key.path') for translation, i18n.language for current lang
  - Language stored in two places: AsyncStorage (for app-level i18n) and UserProfile DB (for data logic)
  - First-launch flow uses router.replace('/language-picker') from root layout useEffect
  - --legacy-peer-deps needed for AsyncStorage install (react-dom peer dep conflict)
  - expo-router Stack.Screen registered in _layout.tsx even for dynamically navigated routes
---

## Iteration 5 - US-005: Lesson Content Data Structure & Seed Data
- What was implemented:
  - Content schema types: Course > Unit > Lesson > Exercise hierarchy (src/content/types.ts)
  - 5 exercise types: multiple_choice, translation, fill_blank, match_pairs, listening
  - LocalizedString type for EN/ES/FR translations on all content
  - Seed data for Unit 1 "Alphabet & Basics" with 5 lessons (src/content/seedData.ts):
    1. First Greek Letters (Α-Ε)
    2. More Greek Letters (Ζ-Κ)
    3. Basic Greetings
    4. Introducing Yourself
    5. Numbers 1-5
  - Each lesson has vocabulary items and 4-5 exercises of varied types
  - Seed data loader (src/content/seedLoader.ts) with version checking via AsyncStorage
  - Vocabulary auto-inserted into SQLite database on first launch
  - Content accessors: getCourseContent(), getUnitById(), getLessonById(), getAllLessonsFlat()
  - Barrel export (src/content/index.ts)
  - Integrated initializeSeedData() into LanguageProvider startup
- Files changed:
  - src/content/types.ts (new - content schema types)
  - src/content/seedData.ts (new - seed data for Unit 1)
  - src/content/seedLoader.ts (new - data loader + content accessors)
  - src/content/index.ts (new - barrel export)
  - src/i18n/LanguageProvider.tsx (added initializeSeedData call on startup)
  - PRD.md (marked US-005 complete)
- Learnings for future iterations:
  - Content lives in src/content/; types, seed data, and loader are separate files
  - Seed data is versioned via AsyncStorage key; bump CURRENT_SEED_VERSION to re-seed
  - Exercise content uses LocalizedString for all user-facing text (prompt, options, translations)
  - Vocabulary is inserted into DB on first load; exercises are read directly from bundled TS
  - getCourseContent() returns the full course; getLessonById() for specific lessons
  - withTransactionSync wraps batch inserts for performance
  - Seed loader checks for existing records before inserting to avoid duplicates
---
